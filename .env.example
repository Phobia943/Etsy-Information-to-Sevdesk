# =============================================================================
# Etsy-SevDesk Sync Tool - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your actual credentials
# NEVER commit .env to version control!

# -----------------------------------------------------------------------------
# Application Settings
# -----------------------------------------------------------------------------
APP_NAME=etsy-sevdesk-sync
APP_ENV=production  # development, staging, production
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json or text
TIMEZONE=Europe/Berlin

# Base currency for accounting (ISO 4217)
BASE_CURRENCY=EUR

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
# PostgreSQL (recommended for production)
DATABASE_URL=postgresql://etsy_sync:your_password@localhost:5432/etsy_sevdesk

# SQLite (for development/testing only)
# DATABASE_URL=sqlite:///./data/etsy_sevdesk.db

# Connection pool settings
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# -----------------------------------------------------------------------------
# Redis Configuration (for Celery/RQ)
# -----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379/0
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# -----------------------------------------------------------------------------
# Etsy API Configuration
# -----------------------------------------------------------------------------
# OAuth2 credentials from Etsy Developer Portal
# https://www.etsy.com/developers/documentation/getting_started/oauth
ETSY_CLIENT_ID=your_etsy_client_id_here
ETSY_CLIENT_SECRET=your_etsy_client_secret_here

# OAuth2 Refresh Token (obtained after initial OAuth flow)
# Keep this secure! Allows offline access to your Etsy shop data
ETSY_REFRESH_TOKEN=your_refresh_token_here

# Your Etsy Shop ID (numeric)
ETSY_SHOP_ID=12345678

# Etsy API Base URL (v3)
ETSY_API_BASE_URL=https://openapi.etsy.com/v3

# API request timeout in seconds
ETSY_API_TIMEOUT=30

# Rate limiting (requests per second)
ETSY_RATE_LIMIT=10

# -----------------------------------------------------------------------------
# sevDesk API Configuration
# -----------------------------------------------------------------------------
# API Token from sevDesk settings
# https://my.sevdesk.de/#/admin/userManagement
SEVDESK_API_TOKEN=your_sevdesk_api_token_here

# sevDesk API Base URL
SEVDESK_API_BASE_URL=https://my.sevdesk.de/api/v1

# API request timeout in seconds
SEVDESK_API_TIMEOUT=30

# Rate limiting (requests per second)
SEVDESK_RATE_LIMIT=5

# -----------------------------------------------------------------------------
# Accounting Configuration
# -----------------------------------------------------------------------------
# Chart of accounts: SKR03 or SKR04
ACCOUNT_CHART=SKR03

# Path to account mapping configuration
ACCOUNT_MAPPING_PATH=./config/account_mapping_skr03.json

# Path to tax rules configuration
TAX_RULES_PATH=./config/tax_rules.json

# Kleinunternehmer (small business) regulation ยง19 UStG
# If true, no VAT will be shown on invoices
KLEINUNTERNEHMER=false

# Default payment terms in days
DEFAULT_PAYMENT_TERMS=14

# Default tax rate for domestic sales (19 or 7)
DEFAULT_TAX_RATE_DOMESTIC=19

# Enable OSS (One-Stop-Shop) for EU cross-border sales
ENABLE_OSS=true

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
# Enable Etsy webhook endpoints (requires webhook setup in Etsy)
FEATURE_USE_WEBHOOKS=false

# Automatically apply payout payments via API
# If false, only create invoices and rely on sevDesk bank import matching
FEATURE_APPLY_PAYOUT_PAYMENTS=false

# Enable automatic refund processing as credit notes
FEATURE_AUTO_PROCESS_REFUNDS=true

# Enable automatic fee voucher creation
FEATURE_AUTO_PROCESS_FEES=true

# Dry-run mode: don't actually create anything in sevDesk
DRY_RUN=false

# -----------------------------------------------------------------------------
# Currency Exchange Configuration
# -----------------------------------------------------------------------------
# Currency exchange rate provider: ecb, fixer, manual
EXCHANGE_RATE_PROVIDER=ecb

# For fixer.io (if using that provider)
# FIXER_API_KEY=your_fixer_api_key

# Manual exchange rates (JSON format, only if provider=manual)
# MANUAL_EXCHANGE_RATES={"USD": 1.08, "GBP": 0.86}

# -----------------------------------------------------------------------------
# Encryption Settings
# -----------------------------------------------------------------------------
# AES encryption key for sensitive data (tokens) in database
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
ENCRYPTION_KEY=your_base64_encryption_key_here

# -----------------------------------------------------------------------------
# Sync Configuration
# -----------------------------------------------------------------------------
# How far back to sync on initial run (ISO date or days)
INITIAL_SYNC_START_DATE=2024-01-01
# INITIAL_SYNC_DAYS_BACK=90

# Incremental sync interval in minutes
SYNC_INTERVAL_MINUTES=15

# Batch size for API requests
SYNC_BATCH_SIZE=100

# Maximum retry attempts for failed syncs
MAX_RETRY_ATTEMPTS=3

# Retry backoff multiplier (exponential)
RETRY_BACKOFF_MULTIPLIER=2

# Retry max wait time in seconds
RETRY_MAX_WAIT=300

# -----------------------------------------------------------------------------
# Webhook Configuration
# -----------------------------------------------------------------------------
# Secret for validating Etsy webhook signatures
ETSY_WEBHOOK_SECRET=your_webhook_secret_here

# Public URL where this service is reachable (for webhook registration)
PUBLIC_BASE_URL=https://your-domain.com

# -----------------------------------------------------------------------------
# Storage Configuration
# -----------------------------------------------------------------------------
# Directory for storing documents (fee reports, etc.)
STORAGE_PATH=./storage

# Document retention period in days
DOCUMENT_RETENTION_DAYS=3650  # 10 years for GoBD compliance

# -----------------------------------------------------------------------------
# GDPR/Privacy Configuration
# -----------------------------------------------------------------------------
# Mask customer email addresses in logs
MASK_CUSTOMER_DATA_IN_LOGS=true

# Hash customer emails in database (for privacy)
HASH_CUSTOMER_EMAILS=false

# Data retention period in days (for audit logs)
AUDIT_LOG_RETENTION_DAYS=3650  # 10 years for GoBD compliance

# -----------------------------------------------------------------------------
# Monitoring & Observability
# -----------------------------------------------------------------------------
# Enable OpenTelemetry (optional)
ENABLE_OTEL=false

# OpenTelemetry endpoint (if enabled)
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# Sentry DSN for error tracking (optional)
# SENTRY_DSN=https://your-sentry-dsn

# Enable health check endpoint
ENABLE_HEALTH_CHECK=true

# -----------------------------------------------------------------------------
# API Server Configuration
# -----------------------------------------------------------------------------
# FastAPI server host and port
API_HOST=0.0.0.0
API_PORT=8000

# Number of worker processes
API_WORKERS=4

# Enable API documentation endpoints (/docs, /redoc)
ENABLE_API_DOCS=true

# API rate limiting (requests per minute per IP)
API_RATE_LIMIT=60

# -----------------------------------------------------------------------------
# Celery Worker Configuration
# -----------------------------------------------------------------------------
# Number of concurrent worker processes
CELERY_WORKER_CONCURRENCY=4

# Worker log level
CELERY_WORKER_LOGLEVEL=INFO

# Task time limit in seconds
CELERY_TASK_TIME_LIMIT=600

# Task soft time limit in seconds (sends exception before hard limit)
CELERY_TASK_SOFT_TIME_LIMIT=540

# -----------------------------------------------------------------------------
# Development/Testing
# -----------------------------------------------------------------------------
# Enable debug mode (verbose logging, auto-reload)
DEBUG=false

# Use VCR cassettes for testing (record/replay HTTP interactions)
USE_VCR_CASSETTES=true

# Test database URL
TEST_DATABASE_URL=sqlite:///./test.db

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
# Allowed hosts for CORS (comma-separated)
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000

# Secret key for session/JWT signing
SECRET_KEY=your_secret_key_here_min_32_chars

# Enable HTTPS redirect
FORCE_HTTPS=false

# -----------------------------------------------------------------------------
# Backup & Disaster Recovery
# -----------------------------------------------------------------------------
# Automatic database backup (if enabled via cron)
ENABLE_AUTO_BACKUP=true

# Backup retention in days
BACKUP_RETENTION_DAYS=30

# Backup storage path
BACKUP_PATH=./backups
